


  
    
  
  

# allow: GET /index.php (request id / rule group 3)
# Actiontest GET
<LocationMatch "^/index.php$">
  # Checking request method
  SecRule REQUEST_METHOD "!^GET$" "t:none,deny,id:3,severity:3,msg:'Request method wrong (it is not GET).'"

  # Strict headercheck (make sure the request contains only predefined request headers)
  SecRule REQUEST_HEADERS_NAMES "!^(Referer|Host|User-Agent|Cookie|Accept|H_[a-z]{1,4}|H_\w{1,4}|H_[\w-]{1,4}|H\[\w{1,4}\]|H\[[\w-]{1,4}\])$" "t:none,deny,id:3,severity:3,msg:'Strict headercheck: At least one request header is not predefined for this path.'"

  # Checking header "Referer"
  SecRule REQUEST_HEADERS:Referer "!^(.*)$" "t:none,deny,id:3,severity:3,msg:'Header Referer failed validity check. Value domain: Custom.'"
  # Checking header "Host"
  SecRule REQUEST_HEADERS:Host "!^(.*)$" "t:none,deny,id:3,severity:3,msg:'Header Host failed validity check. Value domain: Custom.'"
  # Checking header "User-Agent"
  SecRule REQUEST_HEADERS:User-Agent "!^(.*)$" "t:none,deny,id:3,severity:3,msg:'Header User-Agent failed validity check. Value domain: Custom.'"
  # Checking header "Cookie"
  SecRule REQUEST_HEADERS:Cookie "!^(.*)$" "t:none,deny,id:3,severity:3,msg:'Header Cookie failed validity check. Value domain: Custom.'"
  # Checking header "Accept"
  SecRule REQUEST_HEADERS:Accept "!^(.*)$" "t:none,deny,id:3,severity:3,msg:'Header Accept failed validity check. Value domain: Custom.'"
  # Checking header "H_[a-z]{1,4}"
  SecRule REQUEST_HEADERS:'/^H_[a-z]{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Header H_[a-z]{1,4} failed validity check. Value domain: Custom.'"
  # Checking header "H_\w{1,4}"
  SecRule REQUEST_HEADERS:'/^H_\\\w{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Header H_w{1,4} failed validity check. Value domain: Custom.'"
  # Checking header "H_[\w-]{1,4}"
  SecRule REQUEST_HEADERS:'/^H_[\\\w-]{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Header H_[w-]{1,4} failed validity check. Value domain: Custom.'"
  # Checking header "H\[\w{1,4}\]"
  SecRule REQUEST_HEADERS:'/^H\\\[\\\w{1,4}\\\]$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Header H[w{1,4}] failed validity check. Value domain: Custom.'"
  # Checking header "H\[[\w-]{1,4}\]"
  SecRule REQUEST_HEADERS:'/^H\\\[[\\\w-]{1,4}\\\]$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Header H[[w-]{1,4}] failed validity check. Value domain: Custom.'"

  # Strict cookieparametercheck (make sure the request contains only predefined request cookieparameters)
  SecRule REQUEST_COOKIES_NAMES "!^(c_[a-z]{1,4}|c_\w{1,4}|c_[\w-]{1,4}|c\[\w{1,4}\]|c\[[\w-]{1,4}\])$" "t:none,deny,id:3,severity:3,msg:'Strict cookieparametercheck: At least one request cookieparameter is not predefined for this path.'"

  # Checking cookieparameter "c_[a-z]{1,4}"
  SecRule REQUEST_COOKIES:'/^c_[a-z]{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Cookieparameter c_[a-z]{1,4} failed validity check. Value domain: Custom.'"
  # Checking cookieparameter "c_\w{1,4}"
  SecRule REQUEST_COOKIES:'/^c_\\\w{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Cookieparameter c_w{1,4} failed validity check. Value domain: Custom.'"
  # Checking cookieparameter "c_[\w-]{1,4}"
  SecRule REQUEST_COOKIES:'/^c_[\\\w-]{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Cookieparameter c_[w-]{1,4} failed validity check. Value domain: Custom.'"
  # Checking cookieparameter "c\[\w{1,4}\]"
  SecRule REQUEST_COOKIES:'/^c\\\[\\\w{1,4}\\\]$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Cookieparameter c[w{1,4}] failed validity check. Value domain: Custom.'"
  # Checking cookieparameter "c\[[\w-]{1,4}\]"
  SecRule REQUEST_COOKIES:'/^c\\\[[\\\w-]{1,4}\\\]$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Cookieparameter c[[w-]{1,4}] failed validity check. Value domain: Custom.'"

  # Strict querystringparameter-/postparametercheck (make sure the request contains only predefined request querystringparameter-/postparameters)
  SecRule ARGS_NAMES "!^(q_single_integer|q_single_integer_or_empty|q_empty|q_exotic|q_single_letter|q_string_long|qp_single_integer|q_[a-z]{1,4}|q_\w{1,4}|q_[\w-]{1,4}|q\[\w{1,4}\]|q\[[\w-]{1,4}\]|qp_single_integer)$" "t:none,deny,id:3,severity:3,msg:'Strict querystringparameter-/postparametercheck: At least one request querystringparameter-/postparameter is not predefined for this path.'"

  # Checking querystringparameter "q_single_integer"
  SecRule REQUEST_BODY "^q_single_integer[=&]|^q_single_integer$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_single_integer is present in post payload. This is illegal.'"
  SecRule ARGS:q_single_integer "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_single_integer failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q_single_integer_or_empty"
  SecRule REQUEST_BODY "^q_single_integer_or_empty[=&]|^q_single_integer_or_empty$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_single_integer_or_empty is present in post payload. This is illegal.'"
  SecRule ARGS:q_single_integer_or_empty "!^(\d{0,1})$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_single_integer_or_empty failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q_empty"
  SecRule REQUEST_BODY "^q_empty[=&]|^q_empty$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_empty is present in post payload. This is illegal.'"
  SecRule ARGS:q_empty "!^(.{0})$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_empty failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q_exotic"
  SecRule REQUEST_BODY "^q_exotic[=&]|^q_exotic$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_exotic is present in post payload. This is illegal.'"
  SecRule ARGS:q_exotic "!^([\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\x1C\x1D\x1E\x1F\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2A\x2B\x2C\x2D\x2E\x2F\x3A\x3B\x3C\x3D\x3E\x3F\x40\x5B\x5C\x5D\x5E\x5F\x60\x7B\x7C\x7D\x7E\x7F])$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_exotic failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q_single_letter"
  SecRule REQUEST_BODY "^q_single_letter[=&]|^q_single_letter$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_single_letter is present in post payload. This is illegal.'"
  SecRule ARGS:q_single_letter "!^(\w)$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_single_letter failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q_string_long"
  SecRule REQUEST_BODY "^q_string_long[=&]|^q_string_long$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_string_long is present in post payload. This is illegal.'"
  SecRule ARGS:q_string_long "!^([\w ]{0,1024})$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_string_long failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "qp_single_integer"
  SecRule ARGS:qp_single_integer "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter qp_single_integer failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q_[a-z]{1,4}"
  SecRule REQUEST_BODY "^q_[a-z]{1,4}[=&]|^q_[a-z]{1,4}$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_[a-z]{1,4} is present in post payload. This is illegal.'"
  SecRule ARGS:'/^q_[a-z]{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_[a-z]{1,4} failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q_\w{1,4}"
  SecRule REQUEST_BODY "^q_\w{1,4}[=&]|^q_\w{1,4}$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_w{1,4} is present in post payload. This is illegal.'"
  SecRule ARGS:'/^q_\\\w{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_w{1,4} failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q_[\w-]{1,4}"
  SecRule REQUEST_BODY "^q_[\w-]{1,4}[=&]|^q_[\w-]{1,4}$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_[w-]{1,4} is present in post payload. This is illegal.'"
  SecRule ARGS:'/^q_[\\\w-]{1,4}$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q_[w-]{1,4} failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q\[\w{1,4}\]"
  SecRule REQUEST_BODY "^q\[\w{1,4}\][=&]|^q\[\w{1,4}\]$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q[w{1,4}] is present in post payload. This is illegal.'"
  SecRule ARGS:'/^q\\\[\\\w{1,4}\\\]$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q[w{1,4}] failed validity check. Value domain: Custom.'"
  # Checking querystringparameter "q\[[\w-]{1,4}\]"
  SecRule REQUEST_BODY "^q\[[\w-]{1,4}\][=&]|^q\[[\w-]{1,4}\]$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q[[w-]{1,4}] is present in post payload. This is illegal.'"
  SecRule ARGS:'/^q\\\[[\\\w-]{1,4}\\\]$/' "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Querystringparameter q[[w-]{1,4}] failed validity check. Value domain: Custom.'"

  # Checking postparameter "qp_single_integer"
  SecRule ARGS:qp_single_integer "!^(\d)$" "t:none,deny,id:3,severity:3,msg:'Postparameter qp_single_integer failed validity check. Value domain: Custom.'"

  # All checks passed for this path. Request is allowed.
  SecAction "allow,id:3,t:none,msg:'Request passed all checks, it is thus allowed.'"
</LocationMatch>


  

